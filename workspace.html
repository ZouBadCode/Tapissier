<!DOCTYPE html>
<html>
<head>
    <title>workspace</title>
    <style>
        body{
            overflow-x: hidden;
        }
        #topbar{
            background-color: mediumturquoise;
            position:fixed;
            width: 100%;
            height: 55px;
            top:0px;
            left: 0px;
        }
        .topbar_button{
            width: 40px;
            height: 40px;
            top:5px;
            position: relative;
            border: 1px solid white;
            border-radius: 10px;
        }
        .panel {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease;
            transform: translateX(-255px) scale(0.7);  /* 同時平移和縮小 */
            opacity: 0;
            width: 390px;
            height: 740px;
            border-radius: 20px;
            background-color: aliceblue;
            left: 15px; /* 初始的左邊位置，需要調整以便隱藏 */
            bottom: 50px;
            position: fixed; /* 使用 fixed 以便在視窗範圍內顯示動畫 */
        }

        .panel.show {
            transform: translateX(0px) scale(1); /* 同時回到原位並放大 */
            opacity: 1;
        }
        #view{
            position: absolute;
            left: 530px;
            top: 200px;
            width: 960px;
            height: 540px;
        }
        #div_button {
            padding: 10px;
            background: rgb(199, 239, 252);
            opacity: 0.7;
            cursor: move;
            width: 80px;
            height: 80px;
            border-radius: 15px;
            border: rgb(250, 243, 243) solid 1px;
        }

    </style>
</head>

    <body>
        <header id="topbar">
            <button class="topbar_button" id="toolbox-button"></button>
            <button class="topbar_button" id="text-panel-button"></button>
            <button class="topbar_button" id="DOM-visualizer-button"></button>
        </header>
        <iframe id="view" src="/insert" frameborder="0" sandbox="allow-scripts allow-same-origin" ></iframe>
        <div class="panel"id="toolbox-div">
            工具箱內容
            <button id="div_button" draggable="true" onclick="addDiv()">&lt;div&gt;</button>
            <button id="dynamicButton" draggable="true">拖我創建新按鈕</button>
        </div>
        <div class="panel"id="text-panel-div">文本面板內容</div>
        <div class="panel"id="DOM-visualizer-div">DOM可視化內容</div>
    </body>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const buttons = document.querySelectorAll('.topbar_button');
            const panels = document.querySelectorAll('.panel');

            buttons.forEach((button, index) => {
                button.addEventListener('click', () => {
                    panels.forEach((panel, panelIndex) => {
                        if (index === panelIndex) {
                            if (panel.classList.contains('show')) {
                                panel.classList.remove('show');
                            } else {
                                panel.classList.add('show');
                            }
                        } else {
                            panel.classList.remove('show');
                        }
                    });
                });
            });

            var iframe = document.getElementById('view');

            // 設定 iframe 載入後的初始化
            iframe.onload = function() {
                var iframeContent = iframe.contentWindow.document;
                var add_place = iframe.contentWindow.document.body;
                // 事件委派：監聽拖放事件
                iframeContent.addEventListener('dragover', function(event) {
                    event.preventDefault(); // 允許放置
                });

                iframeContent.addEventListener('drop', function(event) {
                    event.preventDefault();
                    var type = event.dataTransfer.getData('text/type');

                    // 使用 switch 判斷類型並創建相應元素
                    switch (type) {
                        case 'newButton':
                            createButton(event, add_place);
                            break;
                        case 'newDiv':
                            createDiv(event, add_place);
                            break;
                        default:
                            console.log('未知類型: ' + type);
                    }
                });
            };
            });

            function createButton(event, parent) {
            var btn = document.createElement('button');
            btn.innerHTML = '新按鈕';
            setElementStyle(btn, event);
            parent.appendChild(btn);
            }

            function createDiv(event, parent) {
            var div = document.createElement('div');
            div.innerHTML = '新 Div';
            setElementStyle(div, event);
            parent.appendChild(div);
            }

            function setElementStyle(element, event) {
            element.style.position = 'absolute';
            element.style.left = event.offsetX + 'px';
            element.style.top = event.offsetY + 'px';
            element.style.padding = '10px';
            element.style.backgroundColor = 'lightcoral';
            element.style.color = 'white';
            element.style.border = 'none';
            element.style.borderRadius = '5px';
            element.style.cursor = 'pointer';
            }

            // 設定拖動事件的相應數據
            document.getElementById('dynamicButton').addEventListener('dragstart', function(event) {
            event.dataTransfer.setData('text/type', 'newButton');
            });

            document.getElementById('div_button').addEventListener('dragstart', function(event) {
            event.dataTransfer.setData('text/type', 'newDiv');
            });
        function addDiv() {
            var iframe = document.getElementById('view');
            var newDiv = iframe.contentWindow.document.createElement('div');
            newDiv.innerHTML = "這是新添加的 div";
            iframe.contentWindow.document.body.appendChild(newDiv);

        }
    </script>
</html>
